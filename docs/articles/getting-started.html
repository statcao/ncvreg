<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting started with ncvreg • ncvreg</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<script src="../extra.js"></script><meta property="og:title" content="Getting started with ncvreg">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ncvreg</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">3.10.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Learn more
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/web/models.html">Models</a>
    </li>
    <li>
      <a href="../articles/web/penalties.html">Penalties</a>
    </li>
    <li>
      <a href="../articles/web/inference-local.html">Inference: Local mfdr</a>
    </li>
    <li>
      <a href="../articles/web/inference-mfdr.html">Inference: Marginal false discovery rates</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pbreheny/ncvreg">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Getting started with ncvreg</h1>
                        <h4 class="author">Patrick Breheny</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pbreheny/ncvreg/blob/master/vignettes/getting-started.rmd"><code>vignettes/getting-started.rmd</code></a></small>
      <div class="hidden name"><code>getting-started.rmd</code></div>

    </div>

    
    
<p><code>ncvreg</code> is an R package for fitting regularization paths for linear regression, GLM, and Cox regression models using lasso or nonconvex penalties, in particular the minimax concave penalty (MCP) and smoothly clipped absolute deviation (SCAD) penalty, with options for additional L<sub>2</sub> penalties (the “elastic net” idea). Utilities for carrying out cross-validation as well as post-fitting visualization, summarization, inference, and prediction are also provided.</p>
<p>This vignette offers a brief introduction to the basic use of <code>ncvreg</code>. For more details on the package, visit the <code>ncvreg</code> website at <a href="http://pbreheny.github.io/ncvreg" class="uri">http://pbreheny.github.io/ncvreg</a>. For more on the algorithms used by <code>ncvreg</code>, see the original article:</p>
<ul>
<li><a href="http://myweb.uiowa.edu/pbreheny/pdf/Breheny2011.pdf">Breheny P and Huang J (2011). Coordinate descent algorithms for nonconvex penalized regression, with applications to biological feature selection. <em>Annals of Applied Statistics</em>, 5: 232–253</a></li>
</ul>
<p>For more about the marginal false discovery rate idea used for post-selection inference, see</p>
<ul>
<li><a href="https://arxiv.org/pdf/1607.05636">Breheny P (to appear). Marginal false discovery rates for penalized regression models. <em>Biostatistics</em></a></li>
</ul>
<p><code>ncvreg</code> comes with a few example data sets; we’ll look at <code>Prostate</code>, which has 8 features and one continuous response, the PSA levels (on the log scale) from men about to undergo radical prostatectomy:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">data</span>(Prostate)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">X &lt;-<span class="st"> </span>Prostate<span class="op">$</span>X</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">y &lt;-<span class="st"> </span>Prostate<span class="op">$</span>y</a></code></pre></div>
<p>To fit a penalized regression model to this data:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ncvreg.html">ncvreg</a></span>(X, y)</a></code></pre></div>
<p>The default penalty here is the minimax concave penalty (MCP), but SCAD and lasso penalties are also available. This produces a path of coefficients, which we can plot with</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">plot</span>(fit)</a></code></pre></div>
<p><img src="getting-started_files/figure-html/plot-1.png" width="480"></p>
<p>Notice that variables enter the model one at a time, and that at any given value of <span class="math inline">\(\lambda\)</span>, several coefficients are zero. To see what the coefficients are, we could use the <code>coef</code> function:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">coef</span>(fit, <span class="dt">lambda=</span><span class="fl">0.05</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co"># (Intercept)      lcavol     lweight         age        lbph         svi </span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#  0.35121089  0.53178994  0.60389694 -0.01530917  0.08874563  0.67256096 </span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#         lcp     gleason       pgg45 </span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#  0.00000000  0.00000000  0.00168038</span></a></code></pre></div>
<p>The <code>summary</code> method can be used for post-selection inference:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">summary</span>(fit, <span class="dt">lambda=</span><span class="fl">0.05</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co"># MCP-penalized linear regression with n=97, p=8</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co"># At lambda=0.0500:</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co"># -------------------------------------------------</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#   Nonzero coefficients         : 6</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#   Expected nonzero coefficients: 2.51</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#   Average mfdr (6 features)    : 0.418</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co"># </span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#         Estimate      z      mfdr</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co"># lcavol   0.53179  8.880   &lt; 1e-04</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co"># svi      0.67256  3.945 0.0018967</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="co"># lweight  0.60390  3.666 0.0050683</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co"># lbph     0.08875  1.928 0.4998035</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="co"># age     -0.01531 -1.788 1.0000000</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="co"># pgg45    0.00168  1.160 1.0000000</span></a></code></pre></div>
<p>In this case, it would appear that <code>lcavol</code>, <code>svi</code>, and <code>lweight</code> are clearly associated with the response, even after adjusting for the other variables in the model, while <code>lbph</code>, <code>age</code>, and <code>pgg45</code> may be false positives included simply by chance.</p>
<p>Typically, one would carry out cross-validation for the purposes of assessing the predictive accuracy of the model at various values of <span class="math inline">\(\lambda\)</span>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">cvfit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cv.ncvreg.html">cv.ncvreg</a></span>(X, y)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw">plot</span>(cvfit)</a></code></pre></div>
<p><img src="getting-started_files/figure-html/cvplot-1.png" width="480"></p>
<p>The value of <span class="math inline">\(\lambda\)</span> that minimizes the cross-validation error is given by <code>cvfit$lambda.min</code>, which in this case is 0.028. Applying <code>coef</code> to the output of <code>cv.ncvreg</code> returns the coefficients at that value of <span class="math inline">\(\lambda\)</span>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">coef</span>(cvfit)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#  (Intercept)       lcavol      lweight          age         lbph </span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#  0.494151714  0.569546490  0.614419845 -0.020913442  0.097352556 </span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#          svi          lcp      gleason        pgg45 </span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#  0.752400486 -0.104960299  0.000000000  0.005324462</span></a></code></pre></div>
<p>Predicted values can be obtained via <code>predict</code>, which has a number of options:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">predict</span>(cvfit, <span class="dt">X=</span><span class="kw">head</span>(X))     <span class="co"># Prediction of response for new observations</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">#         1         2         3         4         5         6 </span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co"># 0.8304032 0.7650898 0.4262070 0.6230109 1.7449493 0.8449584</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="kw">predict</span>(cvfit, <span class="dt">type=</span><span class="st">"nvars"</span>)  <span class="co"># Number of nonzero coefficients</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co"># 0.02762 </span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#       7</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="kw">predict</span>(cvfit, <span class="dt">type=</span><span class="st">"vars"</span>)   <span class="co"># Identity of the nonzero coefficients</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#  lcavol lweight     age    lbph     svi     lcp   pgg45 </span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#       1       2       3       4       5       6       8</span></a></code></pre></div>
<p>Note that the original fit (to the full data set) is returned as <code>cvfit$fit</code>; it is not necessary to call both <code>ncvreg</code> and <code>cv.ncvreg</code> to analyze a data set. For example, <code>plot(cvfit$fit)</code> will produce the same coefficient path plot as <code>plot(fit)</code> above.</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Patrick Breheny.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
