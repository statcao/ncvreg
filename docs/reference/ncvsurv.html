<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fit an MCP- or SCAD-penalized survival model — ncvsurv • ncvreg</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  <script src="../extra.js"></script>
<meta property="og:title" content="Fit an MCP- or SCAD-penalized survival model — ncvsurv" />

<meta property="og:description" content="Fit coefficients paths for MCP- or SCAD-penalized
  Cox regression models over a grid of values for the regularization
  parameter lambda, with option for an additional L2 penalty." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ncvreg</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">3.11.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Learn more
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/web/models.html">Models</a>
    </li>
    <li>
      <a href="../articles/web/penalties.html">Penalties</a>
    </li>
    <li>
      <a href="../articles/web/inference-local.html">Inference: Local mfdr</a>
    </li>
    <li>
      <a href="../articles/web/inference-mfdr.html">Inference: Marginal false discovery rates</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/pbreheny/ncvreg">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit an MCP- or SCAD-penalized survival model</h1>
    
    <div class="hidden name"><code>ncvsurv.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Fit coefficients paths for MCP- or SCAD-penalized
  Cox regression models over a grid of values for the regularization
  parameter lambda, with option for an additional L2 penalty.</p>
    
    </div>

    <pre class="usage"><span class='fu'>ncvsurv</span>(<span class='no'>X</span>, <span class='no'>y</span>, <span class='kw'>penalty</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='st'>"MCP"</span>, <span class='st'>"SCAD"</span>, <span class='st'>"lasso"</span>),
<span class='kw'>gamma</span><span class='kw'>=</span><span class='fu'>switch</span>(<span class='no'>penalty</span>, <span class='kw'>SCAD</span><span class='kw'>=</span><span class='fl'>3.7</span>, <span class='fl'>3</span>), <span class='kw'>alpha</span><span class='kw'>=</span><span class='fl'>1</span>,
<span class='kw'>lambda.min</span><span class='kw'>=</span><span class='fu'>ifelse</span>(<span class='no'>n</span><span class='kw'>&gt;</span><span class='no'>p</span>,<span class='fl'>.001</span>,<span class='fl'>.05</span>), <span class='kw'>nlambda</span><span class='kw'>=</span><span class='fl'>100</span>, <span class='no'>lambda</span>, <span class='kw'>eps</span><span class='kw'>=</span><span class='fl'>1e-4</span>,
<span class='kw'>max.iter</span><span class='kw'>=</span><span class='fl'>10000</span>, <span class='kw'>convex</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>dfmax</span><span class='kw'>=</span><span class='no'>p</span>, <span class='kw'>penalty.factor</span><span class='kw'>=</span><span class='fu'>rep</span>(<span class='fl'>1</span>, <span class='fu'>ncol</span>(<span class='no'>X</span>)),
<span class='kw'>warn</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='no'>returnX</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>X</th>
      <td><p>The design matrix of predictor values.  <code>ncvsurv</code>
    standardizes the data prior to fitting.</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>The time-to-event outcome, as a two-column matrix or
    <code>Surv</code> object.  The first column should be time on study (follow
    up time); the second column should be a binary variable with 1
    indicating that the event has occurred and 0 indicating (right)
    censoring.</p></td>
    </tr>
    <tr>
      <th>penalty</th>
      <td><p>The penalty to be applied to the model.  Either "MCP"
    (the default), "SCAD", or "lasso".</p></td>
    </tr>
    <tr>
      <th>gamma</th>
      <td><p>The tuning parameter of the MCP/SCAD penalty (see
    details).  Default is 3 for MCP and 3.7 for SCAD.</p></td>
    </tr>
    <tr>
      <th>alpha</th>
      <td><p>Tuning parameter for the Mnet estimator which controls
    the relative contributions from the MCP/SCAD penalty and the ridge,
    or L2 penalty.  <code>alpha=1</code> is equivalent to MCP/SCAD penalty,
    while <code>alpha=0</code> would be equivalent to ridge regression.
    However, <code>alpha=0</code> is not supported; <code>alpha</code> may be
    arbitrarily small, but not exactly 0.</p></td>
    </tr>
    <tr>
      <th>lambda.min</th>
      <td><p>The smallest value for lambda, as a fraction of
    lambda.max.  Default is .001 if the number of observations is larger
    than the number of covariates and .05 otherwise.</p></td>
    </tr>
    <tr>
      <th>nlambda</th>
      <td><p>The number of lambda values.  Default is 100.</p></td>
    </tr>
    <tr>
      <th>lambda</th>
      <td><p>A user-specified sequence of lambda values.  By default,
    a sequence of values of length <code>nlambda</code> is computed, equally
    spaced on the log scale.</p></td>
    </tr>
    <tr>
      <th>eps</th>
      <td><p>Convergence threshhold.  The algorithm iterates until the
    RMSD for the change in linear predictors for any coefficient is less
    than <code>eps</code>.  Default is <code>1e-4</code>.</p></td>
    </tr>
    <tr>
      <th>max.iter</th>
      <td><p>Maximum number of iterations (total across entire path).
    Default is 1000.</p></td>
    </tr>
    <tr>
      <th>convex</th>
      <td><p>Calculate index for which objective function ceases to
    be locally convex?  Default is TRUE.</p></td>
    </tr>
    <tr>
      <th>dfmax</th>
      <td><p>Upper bound for the number of nonzero coefficients.
    Default is no upper bound.  However, for large data sets,
    computational burden may be heavy for models with a large number of
    nonzero coefficients.</p></td>
    </tr>
    <tr>
      <th>penalty.factor</th>
      <td><p>A multiplicative factor for the penalty applied
    to each coefficient.  If supplied, <code>penalty.factor</code> must be a
    numeric vector of length equal to the number of columns of
    <code>X</code>.  The purpose of <code>penalty.factor</code> is to apply
    differential penalization if some coefficients are thought to be
    more likely than others to be in the model.  In particular,
    <code>penalty.factor</code> can be 0, in which case the coefficient is
    always in the model without any penalization/shrinkage.</p></td>
    </tr>
    <tr>
      <th>warn</th>
      <td><p>Return warning messages for failures to converge and model
    saturation?  Default is TRUE.</p></td>
    </tr>
    <tr>
      <th>returnX</th>
      <td><p>Return the standardized design matrix along with the
    fit?  By default, this option is turned on if X is under 100 MB, but
    turned off for larger matrices to preserve memory.  Note that
    certain methods, such as <code><a href='summary-ncvreg.html'>summary.ncvsurv</a></code> require
    access to the design matrix and may not be able to run if
    <code>returnX=FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Not used.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The sequence of models indexed by the regularization parameter
  <code>lambda</code> is fit using a coordinate descent algorithm.  In order
  to accomplish this, the second derivative (Hessian) of the Cox partial
  log-likelihood is diagonalized (see references for details).  The
  objective function is defined to be
  $$Q(\beta|X, y) = \frac{1}{n} L(\beta|X, y) +
    P_\lambda(\beta)$$
  where the loss function L is the -2 times the partial log-likelihood
  from the Cox regression model.
  <a href='http://pbreheny.github.io/ncvreg/articles/web/models.html'>See
    here for more details</a>.</p>
<p>Presently, ties are not handled by <code>ncvsurv</code> in a particularly
  sophisticated manner.  This will be improved upon in a future release
  of <code>ncvreg</code>.</p>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object with S3 class <code>"ncvsurv"</code> containing:</p><dl class='dl-horizontal'>
    <dt>beta</dt><dd><p>The fitted matrix of coefficients.  The number of rows is
      equal to the number of coefficients, and the number of columns is
      equal to <code>nlambda</code>.</p></dd>
    <dt>iter</dt><dd><p>A vector of length <code>nlambda</code> containing the number
      of iterations until convergence at each value of <code>lambda</code>.</p></dd>
    <dt>lambda</dt><dd><p>The sequence of regularization parameter values in the
      path.</p></dd>
    <dt>penalty</dt><dd><p>Same as above.</p></dd>
    <dt>model</dt><dd><p>Same as above.</p></dd>
    <dt>gamma</dt><dd><p>Same as above.</p></dd>
    <dt>alpha</dt><dd><p>Same as above.</p></dd>
    <dt>convex.min</dt><dd><p>The last index for which the objective function is
      locally convex.  The smallest value of lambda for which the
      objective function is convex is therefore <code>lambda[convex.min]</code>,
      with corresponding coefficients <code>beta[,convex.min]</code>.</p></dd>
    <dt>loss</dt><dd><p>The negative partial log-likelihood of the fitted model at
      each value of <code>lambda</code>.</p></dd>
    <dt>penalty.factor</dt><dd><p>Same as above.</p></dd>
    <dt>n</dt><dd><p>The number of observations.</p></dd>
  </dl>

<p>For Cox models, the following objects are also returned (and are
  necessary to estimate baseline survival conditonal on the estimated
  regression coefficients), all of which are ordered by time on study.
  I.e., the ith row of <code>W</code> does not correspond to the ith row of
  <code>X</code>):</p>
<p></p><dl class='dl-horizontal'>
    <dt>W</dt><dd><p>Matrix of <code>exp(beta)</code> values for each subject over all
      <code>lambda</code> values.</p></dd>
    <dt>time</dt><dd><p>Times on study.</p></dd>
    <dt>fail</dt><dd><p>Failure event indicator.</p></dd>
  </dl>

<p>Additionally, if <code>returnX=TRUE</code>, the object will also contain</p>
<p></p><dl class='dl-horizontal'>
    <dt>X</dt><dd><p>The standardized design matrix.</p></dd>
  </dl>

    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p></p><ul>
<li><p>Breheny P and Huang J. (2011) Coordinate descentalgorithms
    for nonconvex penalized regression, with applications to biological
    feature selection.  <em>Annals of Applied Statistics</em>, <strong>5</strong>:
    232-253.
    <a href='myweb.uiowa.edu/pbreheny/publications/Breheny2011.pdf'>myweb.uiowa.edu/pbreheny/publications/Breheny2011.pdf</a></p></li>
<li><p>Simon N, Friedman JH, Hastie T, and Tibshirani R. (2011)
    Regularization Paths for Cox's Proportional Hazards Model via
    Coordinate Descent.  <em>Journal of Statistical Software</em>,
    <strong>39</strong>: 1-13.
    <a href='http://www.jstatsoft.org/v39/i05'>http://www.jstatsoft.org/v39/i05</a></p></li>
</ul>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='plot-ncvreg.html'>plot.ncvreg</a></code>, <code><a href='cv-ncvreg.html'>cv.ncvsurv</a></code></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'>data</span>(<span class='no'>Lung</span>)
<span class='no'>X</span> <span class='kw'>&lt;-</span> <span class='no'>Lung</span>$<span class='no'>X</span>
<span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='no'>Lung</span>$<span class='no'>y</span>

<span class='no'>op</span> <span class='kw'>&lt;-</span> <span class='fu'>par</span>(<span class='kw'>mfrow</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='fl'>2</span>,<span class='fl'>2</span>))
<span class='no'>fit</span> <span class='kw'>&lt;-</span> <span class='fu'>ncvsurv</span>(<span class='no'>X</span>, <span class='no'>y</span>)
<span class='fu'>plot</span>(<span class='no'>fit</span>, <span class='kw'>main</span><span class='kw'>=</span><span class='fu'>expression</span>(<span class='fu'>paste</span>(<span class='no'>gamma</span>,<span class='st'>"="</span>,<span class='fl'>3</span>)))
<span class='no'>fit</span> <span class='kw'>&lt;-</span> <span class='fu'>ncvsurv</span>(<span class='no'>X</span>, <span class='no'>y</span>, <span class='kw'>gamma</span><span class='kw'>=</span><span class='fl'>10</span>)
<span class='fu'>plot</span>(<span class='no'>fit</span>, <span class='kw'>main</span><span class='kw'>=</span><span class='fu'>expression</span>(<span class='fu'>paste</span>(<span class='no'>gamma</span>,<span class='st'>"="</span>,<span class='fl'>10</span>)))
<span class='no'>fit</span> <span class='kw'>&lt;-</span> <span class='fu'>ncvsurv</span>(<span class='no'>X</span>, <span class='no'>y</span>, <span class='kw'>gamma</span><span class='kw'>=</span><span class='fl'>1.5</span>)
<span class='fu'>plot</span>(<span class='no'>fit</span>, <span class='kw'>main</span><span class='kw'>=</span><span class='fu'>expression</span>(<span class='fu'>paste</span>(<span class='no'>gamma</span>,<span class='st'>"="</span>,<span class='fl'>1.5</span>)))
<span class='no'>fit</span> <span class='kw'>&lt;-</span> <span class='fu'>ncvsurv</span>(<span class='no'>X</span>, <span class='no'>y</span>, <span class='kw'>penalty</span><span class='kw'>=</span><span class='st'>"SCAD"</span>)
<span class='fu'>plot</span>(<span class='no'>fit</span>, <span class='kw'>main</span><span class='kw'>=</span><span class='fu'>expression</span>(<span class='fu'>paste</span>(<span class='st'>"SCAD, "</span>,<span class='no'>gamma</span>,<span class='st'>"="</span>,<span class='fl'>3</span>)))</div><div class='img'><img src='ncvsurv-1.png' alt='' width='480' height='480' /></div><div class='input'><span class='fu'>par</span>(<span class='no'>op</span>)

<span class='no'>fit</span> <span class='kw'>&lt;-</span> <span class='fu'>ncvsurv</span>(<span class='no'>X</span>,<span class='no'>y</span>)
<span class='no'>ll</span> <span class='kw'>&lt;-</span> <span class='fu'>log</span>(<span class='no'>fit</span>$<span class='no'>lambda</span>)
<span class='no'>op</span> <span class='kw'>&lt;-</span> <span class='fu'>par</span>(<span class='kw'>mfrow</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='fl'>2</span>,<span class='fl'>1</span>))
<span class='fu'>plot</span>(<span class='no'>ll</span>, <span class='fu'>BIC</span>(<span class='no'>fit</span>), <span class='kw'>type</span><span class='kw'>=</span><span class='st'>"l"</span>, <span class='kw'>xlim</span><span class='kw'>=</span><span class='fu'>rev</span>(<span class='fu'>range</span>(<span class='no'>ll</span>)))
<span class='no'>lam</span> <span class='kw'>&lt;-</span> <span class='no'>fit</span>$<span class='no'>lambda</span>[<span class='fu'>which.min</span>(<span class='fu'>BIC</span>(<span class='no'>fit</span>))]
<span class='no'>b</span> <span class='kw'>&lt;-</span> <span class='fu'>coef</span>(<span class='no'>fit</span>, <span class='kw'>lambda</span><span class='kw'>=</span><span class='no'>lam</span>)
<span class='no'>b</span>[<span class='no'>b</span><span class='kw'>!=</span><span class='fl'>0</span>]</div><div class='output co'>#&gt;       karno    squamous       adeno 
#&gt; -0.03316393 -0.42452397  0.41834812 </div><div class='input'><span class='fu'>plot</span>(<span class='no'>fit</span>)</div><div class='input'><span class='fu'>abline</span>(<span class='kw'>v</span><span class='kw'>=</span><span class='no'>lam</span>)</div><div class='img'><img src='ncvsurv-2.png' alt='' width='480' height='480' /></div><div class='input'><span class='fu'>par</span>(<span class='no'>op</span>)

<span class='no'>S</span> <span class='kw'>&lt;-</span> <span class='fu'>predict</span>(<span class='no'>fit</span>, <span class='no'>X</span>, <span class='kw'>type</span><span class='kw'>=</span><span class='st'>'survival'</span>, <span class='kw'>lambda</span><span class='kw'>=</span><span class='no'>lam</span>)
<span class='fu'>plot</span>(<span class='no'>S</span>, <span class='kw'>xlim</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='fl'>0</span>,<span class='fl'>200</span>))</div><div class='img'><img src='ncvsurv-3.png' alt='' width='480' height='480' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>

      <li><a href="#value">Value</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    Patrick Breheny
  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Patrick Breheny.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

